<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETLab API Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            white-space: nowrap;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab:hover {
            background: #e9e9e9;
        }

        .nav-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #4CAF50;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-logged-out {
            background: #f44336;
        }

        .status-logged-in {
            background: #4CAF50;
        }

        .response-section {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .response-section h3 {
            margin-bottom: 15px;
            color: #4CAF50;
        }

        .response-content {
            white-space: pre-wrap;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            margin-bottom: 20px;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #4CAF50;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .results-table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .results-table tr:hover {
            background: #f9f9f9;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .tab-content {
                padding: 20px;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .nav-tab {
                flex: 1;
                min-width: 120px;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì ETLab API Dashboard</h1>
            <p>Complete interface for all ETLab API endpoints</p>
            <p style="margin-top: 10px;">
                <span class="status-indicator" id="authStatus"></span>
                <span id="authText">Not Logged In</span>
            </p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('login')">üîê Login</button>
            <button class="nav-tab" onclick="switchTab('profile')">üë§ Profile</button>
            <button class="nav-tab" onclick="switchTab('results')">üìä Results</button>
            <button class="nav-tab" onclick="switchTab('attendance')">üìÖ Attendance</button>
            <button class="nav-tab" onclick="switchTab('timetable')">üïê Timetable</button>
            <button class="nav-tab" onclick="switchTab('present')">‚úÖ Mark Present</button>
            <button class="nav-tab" onclick="switchTab('absent')">‚ùå Mark Absent</button>
            <button class="nav-tab" onclick="switchTab('status')">üîç Status</button>
        </div>

        <!-- Login Tab -->
        <div id="login" class="tab-content active">
            <div class="form-section">
                <h2>üîê Login to ETLab</h2>
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" placeholder="Enter your username" value="224079">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="Enter your password" value="Midhun@123123">
                </div>
                <button class="btn" onclick="login()">Login</button>
                <button class="btn btn-danger" onclick="logout()" id="logoutBtn" disabled>Logout</button>
            </div>
            <div id="loginResponse" class="response-section" style="display: none;">
                <h3>Response:</h3>
                <div id="loginContent" class="response-content"></div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <div class="form-section">
                <h2>üë§ Get Profile Information</h2>
                <p>Retrieve your complete profile details from ETLab.</p>
                <button class="btn" onclick="getProfile()">Get Profile</button>
            </div>
            <div id="profileResponse" class="response-section" style="display: none;">
                <h3>Profile Information:</h3>
                <div id="profileContent" class="response-content"></div>
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results" class="tab-content">
            <div class="form-section">
                <h2>üìä Get Exam Results</h2>
                <div class="form-group">
                    <label for="semester">Semester:</label>
                    <select id="semester">
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3" selected>Semester 3</option>
                        <option value="4">Semester 4</option>
                        <option value="5">Semester 5</option>
                        <option value="6">Semester 6</option>
                        <option value="7">Semester 7</option>
                        <option value="8">Semester 8</option>
                    </select>
                </div>
                <button class="btn" onclick="getResults()">Get Results</button>
            </div>
            <div id="resultsResponse" class="response-section" style="display: none;">
                <h3>Exam Results:</h3>
                <div id="resultsContent" class="response-content"></div>
            </div>
        </div>

        <!-- Attendance Tab -->
        <div id="attendance" class="tab-content">
            <div class="form-section">
                <h2>üìÖ Get Attendance</h2>
                <p>View your attendance records for all subjects.</p>
                <button class="btn" onclick="getAttendance()">Get Attendance</button>
            </div>
            <div id="attendanceResponse" class="response-section" style="display: none;">
                <h3>Attendance Records:</h3>
                <div id="attendanceContent" class="response-content"></div>
            </div>
        </div>

        <!-- Timetable Tab -->
        <div id="timetable" class="tab-content">
            <div class="form-section">
                <h2>üïê Get Timetable</h2>
                <p>View your class schedule and timetable.</p>
                <button class="btn" onclick="getTimetable()">Get Timetable</button>
            </div>
            <div id="timetableResponse" class="response-section" style="display: none;">
                <h3>Class Timetable:</h3>
                <div id="timetableContent" class="response-content"></div>
            </div>
        </div>

        <!-- Mark Present Tab -->
        <div id="present" class="tab-content">
            <div class="form-section">
                <h2>‚úÖ Mark Present</h2>
                <div class="form-group">
                    <label for="presentSubject">Subject Code:</label>
                    <input type="text" id="presentSubject" placeholder="e.g., 24CST303">
                </div>
                <div class="form-group">
                    <label for="presentDate">Date:</label>
                    <input type="date" id="presentDate">
                </div>
                <button class="btn" onclick="markPresent()">Mark Present</button>
            </div>
            <div id="presentResponse" class="response-section" style="display: none;">
                <h3>Mark Present Response:</h3>
                <div id="presentContent" class="response-content"></div>
            </div>
        </div>

        <!-- Mark Absent Tab -->
        <div id="absent" class="tab-content">
            <div class="form-section">
                <h2>‚ùå Mark Absent</h2>
                <div class="form-group">
                    <label for="absentSubject">Subject Code:</label>
                    <input type="text" id="absentSubject" placeholder="e.g., 24CST303">
                </div>
                <div class="form-group">
                    <label for="absentDate">Date:</label>
                    <input type="date" id="absentDate">
                </div>
                <button class="btn" onclick="markAbsent()">Mark Absent</button>
            </div>
            <div id="absentResponse" class="response-section" style="display: none;">
                <h3>Mark Absent Response:</h3>
                <div id="absentContent" class="response-content"></div>
            </div>
        </div>

        <!-- Status Tab -->
        <div id="status" class="tab-content">
            <div class="form-section">
                <h2>üîç API Status</h2>
                <p>Check the status of the ETLab API server.</p>
                <button class="btn" onclick="getStatus()">Check Status</button>
            </div>
            <div id="statusResponse" class="response-section" style="display: none;">
                <h3>API Status:</h3>
                <div id="statusContent" class="response-content"></div>
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Processing request...</p>
        </div>
    </div>

    <script>
        // Global variables
        let authToken = localStorage.getItem('etlab_token');
        const API_BASE = 'http://localhost:5000/api';

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            updateAuthStatus();
            
            // Set current date for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('presentDate').value = today;
            document.getElementById('absentDate').value = today;
        });

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Update authentication status display
        function updateAuthStatus() {
            const statusIndicator = document.getElementById('authStatus');
            const statusText = document.getElementById('authText');
            const logoutBtn = document.getElementById('logoutBtn');

            if (authToken) {
                statusIndicator.className = 'status-indicator status-logged-in';
                statusText.textContent = 'Logged In';
                logoutBtn.disabled = false;
            } else {
                statusIndicator.className = 'status-indicator status-logged-out';
                statusText.textContent = 'Not Logged In';
                logoutBtn.disabled = true;
            }
        }

        // Show/hide loading indicator
        function showLoading() {
            document.getElementById('loading').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }

        // Generic API call function
        async function makeAPICall(endpoint, method = 'GET', data = null) {
            showLoading();
            
            const config = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            // Add authorization header if token exists
            if (authToken) {
                config.headers['Authorization'] = `Bearer ${authToken}`;
            }

            // Add data for POST requests
            if (data && method === 'POST') {
                config.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                const result = await response.json();
                
                hideLoading();
                
                return {
                    status: response.status,
                    data: result,
                    success: response.ok
                };
            } catch (error) {
                hideLoading();
                return {
                    status: 0,
                    data: { error: error.message },
                    success: false
                };
            }
        }

        // Display response in specified container
        function displayResponse(containerId, contentId, response) {
            const container = document.getElementById(containerId);
            const content = document.getElementById(contentId);
            
            container.style.display = 'block';
            
            let displayText = `Status: ${response.status}\n\n`;
            displayText += JSON.stringify(response.data, null, 2);
            
            content.textContent = displayText;
        }

        // Login function
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }

            const response = await makeAPICall('/login', 'POST', { username, password });
            
            if (response.success && response.data.token) {
                authToken = response.data.token;
                localStorage.setItem('etlab_token', authToken);
                updateAuthStatus();
                alert('Login successful!');
            }

            displayResponse('loginResponse', 'loginContent', response);
        }

        // Logout function
        async function logout() {
            const response = await makeAPICall('/logout', 'POST');
            
            authToken = null;
            localStorage.removeItem('etlab_token');
            updateAuthStatus();
            
            // Clear all response sections
            const responseSections = document.querySelectorAll('.response-section');
            responseSections.forEach(section => section.style.display = 'none');
            
            displayResponse('loginResponse', 'loginContent', response);
        }

        // Get profile function
        async function getProfile() {
            if (!authToken) {
                alert('Please login first');
                return;
            }

            const response = await makeAPICall('/profile');
            displayResponse('profileResponse', 'profileContent', response);
        }

        // Get results function
        async function getResults() {
            if (!authToken) {
                alert('Please login first');
                return;
            }

            const semester = document.getElementById('semester').value;
            const response = await makeAPICall(`/results?semester=${semester}`);
            displayResponse('resultsResponse', 'resultsContent', response);
        }

        // Get attendance function
        async function getAttendance() {
            if (!authToken) {
                alert('Please login first');
                return;
            }

            const response = await makeAPICall('/attendance');
            displayResponse('attendanceResponse', 'attendanceContent', response);
        }

        // Get timetable function
        async function getTimetable() {
            if (!authToken) {
                alert('Please login first');
                return;
            }

            const response = await makeAPICall('/timetable');
            displayResponse('timetableResponse', 'timetableContent', response);
        }

        // Mark present function
        async function markPresent() {
            if (!authToken) {
                alert('Please login first');
                return;
            }

            const subject = document.getElementById('presentSubject').value;
            const date = document.getElementById('presentDate').value;

            if (!subject || !date) {
                alert('Please enter both subject and date');
                return;
            }

            const response = await makeAPICall('/present', 'POST', { subject, date });
            displayResponse('presentResponse', 'presentContent', response);
        }

        // Mark absent function
        async function markAbsent() {
            if (!authToken) {
                alert('Please login first');
                return;
            }

            const subject = document.getElementById('absentSubject').value;
            const date = document.getElementById('absentDate').value;

            if (!subject || !date) {
                alert('Please enter both subject and date');
                return;
            }

            const response = await makeAPICall('/absent', 'POST', { subject, date });
            displayResponse('absentResponse', 'absentContent', response);
        }

        // Get status function
        async function getStatus() {
            const response = await makeAPICall('/status');
            displayResponse('statusResponse', 'statusContent', response);
        }
    </script>
</body>
</html>